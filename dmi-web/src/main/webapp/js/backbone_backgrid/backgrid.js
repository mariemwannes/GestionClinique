!function(root,$,_,Backbone){"use strict";function capitalize(e){return String.fromCharCode(e.charCodeAt(0)-32)+e.slice(1)}function lpad(e,t,i){var r=t-(e+"").length;r=0>r?0:r;for(var n="",o=0;r>o;o++)n+=i;return n+e}function requireOptions(e,t){for(var i=0;i<t.length;i++){var r=t[i];if(_.isUndefined(e[r]))throw new TypeError("'"+r+"' is required")}}function resolveNameToClass(e,t){if(_.isString(e)){var i=capitalize(e)+t,r=Backgrid[i]||Backgrid.Extension[i];if(_.isUndefined(r))throw new ReferenceError("Class '"+i+"' not found");return r}return e}var window=root,Backgrid=root.Backgrid={VERSION:"0.1.4",Extension:{}},ws="	\n\f\r   ᠎             　\u2028\u2029﻿";if(!String.prototype.trim||ws.trim()){ws="["+ws+"]";var trimBeginRegexp=new RegExp("^"+ws+ws+"*"),trimEndRegexp=new RegExp(ws+ws+"*$");String.prototype.trim=function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return String(this).replace(trimBeginRegexp,"").replace(trimEndRegexp,"")}}var CellFormatter=Backgrid.CellFormatter=function(){};_.extend(CellFormatter.prototype,{fromRaw:function(e){return e},toRaw:function(e){return e}});var NumberFormatter=Backgrid.NumberFormatter=function(e){if(e=e?_.clone(e):{},_.extend(this,this.defaults,e),this.decimals<0||this.decimals>20)throw new RangeError("decimals must be between 0 and 20")};NumberFormatter.prototype=new CellFormatter,_.extend(NumberFormatter.prototype,{defaults:{decimals:2,decimalSeparator:".",orderSeparator:","},HUMANIZED_NUM_RE:/(\d)(?=(?:\d{3})+$)/g,fromRaw:function(e){if(isNaN(e)||null===e)return"";e=e.toFixed(~~this.decimals);var t=e.split("."),i=t[0],r=t[1]?(this.decimalSeparator||".")+t[1]:"";return i.replace(this.HUMANIZED_NUM_RE,"$1"+this.orderSeparator)+r},toRaw:function(e){for(var t="",i=e.trim().split(this.orderSeparator),r=0;r<i.length;r++)t+=i[r];var n=t.split(this.decimalSeparator);t="";for(var r=0;r<n.length;r++)t=t+n[r]+".";"."===t[t.length-1]&&(t=t.slice(0,t.length-1));var o=1*(1*t).toFixed(~~this.decimals);return _.isNumber(o)&&!_.isNaN(o)?o:void 0}});var DatetimeFormatter=Backgrid.DatetimeFormatter=function(e){if(e=e?_.clone(e):{},_.extend(this,this.defaults,e),!this.includeDate&&!this.includeTime)throw new Error("Either includeDate or includeTime must be true")};DatetimeFormatter.prototype=new CellFormatter,_.extend(DatetimeFormatter.prototype,{defaults:{includeDate:!0,includeTime:!0,includeMilli:!1},DATE_RE:/^([+\-]?\d{4})-(\d{2})-(\d{2})$/,TIME_RE:/^(\d{2}):(\d{2}):(\d{2})(\.(\d{3}))?$/,ISO_SPLITTER_RE:/T|Z| +/,_convert:function(e,t){if(_.isNull(e)||_.isUndefined(e))return e;e=e.trim();var i=e.split(this.ISO_SPLITTER_RE)||[],r=this.DATE_RE.test(i[0])?i[0]:"",n=r&&i[1]?i[1]:this.TIME_RE.test(i[0])?i[0]:"",o=this.DATE_RE.exec(r)||[],l=this.TIME_RE.exec(n)||[];if(t){if(this.includeDate&&_.isUndefined(o[0]))return;if(this.includeTime&&_.isUndefined(l[0]))return;if(!this.includeDate&&r)return;if(!this.includeTime&&n)return}var s=new Date(Date.UTC(1*o[1]||0,1*o[2]-1||0,1*o[3]||0,1*l[1]||null,1*l[2]||null,1*l[3]||null,1*l[5]||null)),a="";return this.includeDate&&(a=lpad(s.getUTCFullYear(),4,0)+"-"+lpad(s.getUTCMonth()+1,2,0)+"-"+lpad(s.getUTCDate(),2,0)),this.includeTime&&(a=a+(this.includeDate?"T":"")+lpad(s.getUTCHours(),2,0)+":"+lpad(s.getUTCMinutes(),2,0)+":"+lpad(s.getUTCSeconds(),2,0),this.includeMilli&&(a=a+"."+lpad(s.getUTCMilliseconds(),3,0))),this.includeDate&&this.includeTime&&(a+="Z"),a},fromRaw:function(e){return this._convert(e)},toRaw:function(e){return this._convert(e,!0)}});var CellEditor=Backgrid.CellEditor=Backbone.View.extend({initialize:function(e){requireOptions(e,["formatter","column","model"]),this.parent=e.parent,this.formatter=e.formatter,this.column=e.column,this.column instanceof Column||(this.column=new Column(this.column)),this.parent&&_.isFunction(this.parent.on)&&this.listenTo(this.parent,"editing",this.postRender)},postRender:function(){return this.$el.focus(),this}}),InputCellEditor=Backgrid.InputCellEditor=CellEditor.extend({tagName:"input",attributes:{type:"text"},events:{blur:"saveOrCancel",keydown:"saveOrCancel"},initialize:function(e){CellEditor.prototype.initialize.apply(this,arguments),e.placeholder&&this.$el.attr("placeholder",e.placeholder),this.listenTo(this,"done",this.remove)},render:function(){var a=this.formatter.fromRaw(this.model.get(this.column.get("name")));if(void 0===a){for(var pathValue=this.column.get("name"),attributes=pathValue.split("_"),instruction='this.$el.val(this.formatter.fromRaw(this.model.get("'+attributes[0]+'")',i=1;i<attributes.length;i++)instruction=instruction.concat("."+attributes[i]);eval(instruction+"))")}else this.$el.val(this.formatter.fromRaw(this.model.get(this.column.get("name"))));return this},saveOrCancel:function(e){var a=this.formatter.fromRaw(this.model.get(this.column.get("name")));if("keydown"===e.type)if(13===e.keyCode||9===e.keyCode)if(e.preventDefault(),void 0===a){for(var valueToSet=this.formatter.toRaw(this.$el.val()),pathValue=this.column.get("name"),attributes=pathValue.split("_"),instruction="this.model",instruction2="this.model",instructionAttr=" this.model.attributes",i=0;i<attributes.length;i++)i!=attributes.length-1?(instruction=instruction.concat("."+attributes[i]),instruction2=instruction2.concat("."+attributes[i]),instructionAttr=instructionAttr.concat("."+attributes[i])):(instruction=instruction.concat('.set("'+attributes[i]+'","'+valueToSet+'",{validate: true})'),instruction2=instruction2.concat('.get("'+attributes[i]+'")'),instructionAttr=instructionAttr.concat("."+attributes[i]));_.isUndefined(valueToSet)||!eval(instruction)?this.trigger("error"):(eval(instructionAttr+"="+instruction2),this.trigger("done"))}else{var valueToSet=this.formatter.toRaw(this.$el.val());this.trigger(_.isUndefined(valueToSet)||!this.model.set(this.column.get("name"),valueToSet,{validate:!0})?"error":"done")}else 27===e.keyCode&&(e.stopPropagation(),this.trigger("done"));else if("blur"===e.type){var a=this.formatter.fromRaw(this.model.get(this.column.get("name")));if(void 0===a){for(var pathValue=this.column.get("name"),attributes=pathValue.split("_"),instruction='this.formatter.fromRaw(this.model.get("'+attributes[0]+'")',i=1;i<attributes.length;i++)instruction=instruction.concat("."+attributes[i]);if(eval(instruction+")")===this.$el.val())this.trigger("done");else var self=this,timeout=window.setTimeout(function(){self.$el.focus(),window.clearTimeout(timeout)},1)}else if(this.formatter.fromRaw(this.model.get(this.column.get("name")))===this.$el.val())this.trigger("done");else var self=this,timeout=window.setTimeout(function(){self.$el.focus(),window.clearTimeout(timeout)},1)}},postRender:function(){if("right"===this.$el.css("text-align")){var e=this.$el.val();this.$el.focus().val(null).val(e)}else this.$el.focus();return this}}),Cell=Backgrid.Cell=Backbone.View.extend({tagName:"td",formatter:new CellFormatter,editor:InputCellEditor,events:{click:"enterEditMode"},initialize:function(e){requireOptions(e,["model","column"]),this.column=e.column,this.column instanceof Column||(this.column=new Column(this.column)),this.formatter=resolveNameToClass(this.formatter,"Formatter"),this.editor=resolveNameToClass(this.editor,"CellEditor"),this.listenTo(this.model,"change:"+this.column.get("name"),function(){this.$el.hasClass("editor")||this.render()})},render:function(){return this.$el.empty().text(this.formatter.fromRaw(this.model.get(this.column.get("name")))),this},enterEditMode:function(){this.column.get("editable")&&(this.currentEditor=new this.editor({parent:this,column:this.column,model:this.model,formatter:this.formatter}),this.trigger("edit",this,this.currentEditor),this.listenTo(this.currentEditor,"done",this.exitEditMode),this.listenTo(this.currentEditor,"error",this.renderError),this.$el.empty(),this.undelegateEvents(),this.$el.append(this.currentEditor.$el),this.currentEditor.render(),this.$el.addClass("editor"),this.trigger("editing",this,this.currentEditor))},renderError:function(){this.$el.addClass("error")},exitEditMode:function(){this.$el.removeClass("error"),this.currentEditor.off(null,null,this),this.currentEditor.remove(),delete this.currentEditor,this.$el.removeClass("editor"),this.render(),this.delegateEvents()},remove:function(){return this.currentEditor&&(this.currentEditor.remove.apply(this,arguments),delete this.currentEditor),Backbone.View.prototype.remove.apply(this,arguments)}}),StringCell=Backgrid.StringCell=Cell.extend({className:"string-cell"}),UriCell=Backgrid.UriCell=Cell.extend({className:"uri-cell",formatter:{fromRaw:function(e){return e},toRaw:function(e){var t=encodeURI(e);return"undefined"===t?void 0:t}},render:function(){this.$el.empty();var e=this.formatter.fromRaw(this.model.get(this.column.get("name")));return this.$el.append($("<a>",{href:e,title:e,target:"_blank"}).text(e)),this}}),EmailCell=Backgrid.EmailCell=Cell.extend({className:"email-cell",formatter:{fromRaw:function(e){return e},toRaw:function(e){var t=e.split("@");return 2===t.length&&_.all(t)?e:void 0}},render:function(){this.$el.empty();var e=this.formatter.fromRaw(this.model.get(this.column.get("name")));return this.$el.append($("<a>",{href:"mailto:"+e,title:e}).text(e)),this}}),NumberCell=Backgrid.NumberCell=Cell.extend({className:"number-cell",decimals:NumberFormatter.prototype.defaults.decimals,decimalSeparator:NumberFormatter.prototype.defaults.decimalSeparator,orderSeparator:NumberFormatter.prototype.defaults.orderSeparator,formatter:NumberFormatter,initialize:function(){Cell.prototype.initialize.apply(this,arguments),this.formatter=new this.formatter({decimals:this.decimals,decimalSeparator:this.decimalSeparator,orderSeparator:this.orderSeparator})}}),IntegerCell=Backgrid.IntegerCell=NumberCell.extend({className:"integer-cell",decimals:0}),DatetimeCell=Backgrid.DatetimeCell=Cell.extend({className:"datetime-cell",includeDate:DatetimeFormatter.prototype.defaults.includeDate,includeTime:DatetimeFormatter.prototype.defaults.includeTime,includeMilli:DatetimeFormatter.prototype.defaults.includeMilli,formatter:DatetimeFormatter,initialize:function(){Cell.prototype.initialize.apply(this,arguments),this.formatter=new this.formatter({includeDate:this.includeDate,includeTime:this.includeTime,includeMilli:this.includeMilli});var e=this.includeDate?"YYYY-MM-DD":"";e+=this.includeDate&&this.includeTime?"T":"",e+=this.includeTime?"HH:mm:ss":"",e+=this.includeTime&&this.includeMilli?".SSS":"",this.editor=this.editor.extend({attributes:_.extend({},this.editor.prototype.attributes,this.editor.attributes,{placeholder:e})})}}),DateCell=Backgrid.DateCell=DatetimeCell.extend({className:"date-cell",includeTime:!1}),TimeCell=Backgrid.TimeCell=DatetimeCell.extend({className:"time-cell",includeDate:!1}),BooleanCell=Backgrid.BooleanCell=Cell.extend({className:"boolean-cell",editor:_.template("<input type='checkbox'<%= checked ? checked='checked' : '' %> />'"),events:{dblclick:"enterEditMode","blur input[type=checkbox]":"exitEditMode","change input[type=checkbox]":"save"},render:function(){return this.$el.empty(),this.currentEditor=$(this.editor({checked:this.formatter.fromRaw(this.model.get(this.column.get("name")))})),this.$el.append(this.currentEditor),this},enterEditMode:function(){this.$el.addClass("editor"),this.currentEditor.focus()},exitEditMode:function(){this.$el.removeClass("editor")},save:function(){var e=this.formatter.toRaw(this.currentEditor.prop("checked"));this.model.set(this.column.get("name"),e)}}),SelectCellEditor=Backgrid.SelectCellEditor=CellEditor.extend({tagName:"select",events:{change:"save",blur:"save"},template:_.template('<option value="<%- value %>" <%= selected ? \'selected="selected"\' : "" %>><%- text %></option>'),setOptionValues:function(e){this.optionValues=e},_renderOptions:function(e,t){for(var i="",r=0;r<e.length;r++)i+=this.template({text:e[r][0],value:e[r][1],selected:t==e[r][1]});return i},render:function(){this.$el.empty();var e=_.result(this,"optionValues"),t=this.model.get(this.column.get("name"));if(!_.isArray(e))throw TypeError("optionValues must be an array");for(var i=null,r=null,i=null,n=null,o=null,l=0;l<e.length;l++){var i=e[l];if(_.isArray(i))r=i[0],i=i[1],this.$el.append(this.template({text:r,value:i,selected:i==t}));else{if(!_.isObject(i))throw TypeError("optionValues elements must be a name-value pair or an object hash of { name: 'optgroup label', value: [option name-value pairs] }");n=i.name,o=$("<optgroup></optgroup>",{label:n}),o.append(this._renderOptions(i.values,t)),this.$el.append(o)}}return this},save:function(){this.model.set(this.column.get("name"),this.formatter.toRaw(this.$el.val())),this.trigger("done")}}),SelectCell=Backgrid.SelectCell=Cell.extend({className:"select-cell",editor:SelectCellEditor,optionValues:void 0,initialize:function(){Cell.prototype.initialize.apply(this,arguments),requireOptions(this,["optionValues"]),this.optionValues=_.result(this,"optionValues"),this.listenTo(this,"edit",this.setOptionValues)},setOptionValues:function(e,t){t.setOptionValues(this.optionValues)},render:function(){this.$el.empty();var e=this.optionValues,t=this.formatter.fromRaw(this.model.get(this.column.get("name")));try{if(!_.isArray(e)||_.isEmpty(e))throw new TypeError;for(var i=0;i<e.length;i++){var r=e[i];if(_.isArray(r)){var n=r[0],r=r[1];if(r==t){this.$el.append(n);break}}else{if(!_.isObject(r))throw new TypeError;for(var o=r.values,l=0;l<o.length;l++){var s=o[l];if(s[1]==t){this.$el.append(s[0]);break}}}}}catch(a){if(a instanceof TypeError)throw TypeError("'optionValues' must be of type {Array.<Array>|Array.<{name: string, values: Array.<Array>}>}");throw a}return this}}),Column=Backgrid.Column=Backbone.Model.extend({defaults:{name:void 0,label:void 0,sortable:!0,editable:!0,renderable:!0,formatter:void 0,cell:void 0,headerCell:void 0},initialize:function(e){requireOptions(e,["cell","name"]),this.has("label")||this.set({label:this.get("name")},{silent:!0});var t=resolveNameToClass(this.get("cell"),"Cell");this.set({cell:t},{silent:!0})}}),Columns=Backgrid.Columns=Backbone.Collection.extend({model:Column}),Row=Backgrid.Row=Backbone.View.extend({tagName:"tr",initOptionRequires:["columns","model"],initialize:function(e){requireOptions(e,this.initOptionRequires);var t=this.columns=e.columns;t instanceof Backbone.Collection||(t=this.columns=new Columns(t));for(var i=this.cells=[],r=0;r<t.length;r++)i.push(this.makeCell(t.at(r),e));this.listenTo(t,"change:renderable",function(e,t){for(var r=0;r<i.length;r++){var n=i[r];n.column.get("name")==e.get("name")&&(t?n.$el.show():n.$el.hide())}}),this.listenTo(t,"add",function(t,r){var n=r.indexOf(t),o=this.makeCell(t,e);i.splice(n,0,o),o.column.get("renderable")||o.$el.hide();var l=this.$el;0===n?l.prepend(o.render().$el):n===r.length-1?l.append(o.render().$el):l.children().eq(n).before(o.render().$el)}),this.listenTo(t,"remove",function(e,t,r){i[r.index].remove(),i.splice(r.index,1)})},makeCell:function(e){return new(e.get("cell"))({column:e,model:this.model})},render:function(){this.$el.empty();for(var e=document.createDocumentFragment(),t=0;t<this.cells.length;t++){var i=this.cells[t];e.appendChild(i.render().el),i.column.get("renderable")||i.$el.hide()}return this.el.appendChild(e),this},remove:function(){for(var e=0;e<this.cells.length;e++){var t=this.cells[e];t.remove.apply(t,arguments)}return Backbone.View.prototype.remove.apply(this,arguments)}}),HeaderCell=Backgrid.HeaderCell=Backbone.View.extend({tagName:"th",events:{"click a":"onClick"},_direction:null,initialize:function(e){requireOptions(e,["column","collection"]),this.column=e.column,this.column instanceof Column||(this.column=new Column(this.column)),this.listenTo(Backbone,"backgrid:sort",this._resetCellDirection)},direction:function(e){return arguments.length&&(this._direction&&this.$el.removeClass(this._direction),e&&this.$el.addClass(e),this._direction=e),this._direction},_resetCellDirection:function(e,t,i,r){r==this.collection&&this.direction(e!==this.column.get("name")?null:t)},onClick:function(e){e.preventDefault();var t=this.column.get("name");this.column.get("sortable")&&("ascending"===this.direction()?this.sort(t,"descending",function(e,i){var r=e.get(t),n=i.get(t);return r===n?0:r>n?-1:1}):"descending"===this.direction()?this.sort(t,null):this.sort(t,"ascending",function(e,i){var r=e.get(t),n=i.get(t);return r===n?0:n>r?-1:1}))},sort:function(e,t,i){i=i||this._cidComparator;var r=this.collection;if(Backbone.PageableCollection&&r instanceof Backbone.PageableCollection){var n;n="ascending"===t?-1:"descending"===t?1:null,r.setSorting(n?e:null,n),"client"==r.mode?(r.fullCollection.comparator||(r.fullCollection.comparator=i),r.fullCollection.sort()):r.fetch()}else r.comparator=i,r.sort();Backbone.trigger("backgrid:sort",e,t,i,this.collection)},_cidComparator:function(e,t){var i=e.cid,r=t.cid;if(!_.isUndefined(i)&&!_.isUndefined(r)){if(i=1*i.slice(1),r=1*r.slice(1),r>i)return-1;if(i>r)return 1}return 0},render:function(){this.$el.empty();var e=$("<a>").text(this.column.get("label")).append("<b class='sort-caret'></b>");return this.$el.append(e),this}}),HeaderRow=Backgrid.HeaderRow=Backgrid.Row.extend({initOptionRequires:["columns","collection"],initialize:function(){Backgrid.Row.prototype.initialize.apply(this,arguments)},makeCell:function(e,t){var i=e.get("headerCell")||t.headerCell||HeaderCell;return i=new i({column:e,collection:this.collection})}}),Header=Backgrid.Header=Backbone.View.extend({tagName:"thead",initialize:function(e){requireOptions(e,["columns","collection"]),this.columns=e.columns,this.columns instanceof Backbone.Collection||(this.columns=new Columns(this.columns)),this.row=new Backgrid.HeaderRow({columns:this.columns,collection:this.collection})},render:function(){return this.$el.append(this.row.render().$el),this},remove:function(){return this.row.remove.apply(this.row,arguments),Backbone.View.prototype.remove.apply(this,arguments)}}),Body=Backgrid.Body=Backbone.View.extend({tagName:"tbody",initialize:function(e){this.columns=e.columns,this.columns instanceof Backbone.Collection||(this.columns=new Columns(this.columns)),this.row=e.row||Row,this.rows=this.collection.map(function(e){var t=new this.row({columns:this.columns,model:e});return t},this),this.emptyText=e.emptyText,this._unshiftEmptyRowMayBe();var t=this.collection;this.listenTo(t,"add",this.insertRow),this.listenTo(t,"remove",this.removeRow),this.listenTo(t,"sort",this.refresh),this.listenTo(t,"reset",this.refresh),this.listenTo(t,"backgrid:sort",this.sort),this.listenTo(t,"backgrid:edited",this.moveToNextCell)},_unshiftEmptyRowMayBe:function(){0===this.rows.length&&null!=this.emptyText&&this.rows.unshift(new EmptyRow({emptyText:this.emptyText,columns:this.columns}))},insertRow:function(e,t,i){if(this.rows[0]instanceof EmptyRow&&this.rows.pop().remove(),!(t instanceof Backbone.Collection||i))return void this.collection.add(e,i=t);i=_.extend({render:!0},i||{});var r=new this.row({columns:this.columns,model:e}),n=t.indexOf(e);this.rows.splice(n,0,r);var o=this.$el,l=o.children(),s=r.render().$el;return i.render&&(n>=l.length?o.append(s):l.eq(n).before(s)),this},removeRow:function(e,t,i){return i?((_.isUndefined(i.render)||i.render)&&this.rows[i.index].remove(),this.rows.splice(i.index,1),this._unshiftEmptyRowMayBe(),this):(this.collection.remove(e,i=t),void this._unshiftEmptyRowMayBe())},refresh:function(){for(var e=0;e<this.rows.length;e++)this.rows[e].remove();return this.rows=this.collection.map(function(e){var t=new this.row({columns:this.columns,model:e});return t},this),this._unshiftEmptyRowMayBe(),this.render(),this.collection.trigger("backgrid:refresh",this),this},render:function(){this.$el.empty();for(var e=document.createDocumentFragment(),t=0;t<this.rows.length;t++){var i=this.rows[t];e.appendChild(i.render().el)}return this.el.appendChild(e),this.delegateEvents(),this},remove:function(){for(var e=0;e<this.rows.length;e++){var t=this.rows[e];t.remove.apply(t,arguments)}return Backbone.View.prototype.remove.apply(this,arguments)},sort:function(e,t){_.isString(e)&&(e=this.columns.findWhere({name:e}));var i,r=this.collection;i="ascending"===t?-1:"descending"===t?1:null;var n=this.makeComparator(e.get("name"),i,i?e.sortValue():function(e){return e.cid});return Backbone.PageableCollection&&r instanceof Backbone.PageableCollection?(r.setSorting(i&&e.get("name"),i,{sortValue:e.sortValue()}),"client"==r.mode?(null==r.fullCollection.comparator&&(r.fullCollection.comparator=n),r.fullCollection.sort()):r.fetch({reset:!0})):(r.comparator=n,r.sort()),this},makeComparator:function(e,t,i){return function(r,n){var o,l=i(r,e),s=i(n,e);return 1===t&&(o=l,l=s,s=o),l===s?0:s>l?-1:1}},moveToNextCell:function(e,t,i){var r,n,o,l=this.collection.indexOf(e),s=this.columns.indexOf(t);if(this.rows[l].cells[s].exitEditMode(),i.moveUp()||i.moveDown()||i.moveLeft()||i.moveRight()||i.save()){var a=this.columns.length,c=a*this.collection.length;if(i.moveUp()||i.moveDown()){var u=this.rows[l+(i.moveUp()?-1:1)];u&&(r=u.cells[s],Backgrid.callByNeed(r.column.editable(),r.column,e)&&r.enterEditMode())}else if(i.moveLeft()||i.moveRight())for(var h=i.moveRight(),d=l*a+s+(h?1:-1);d>=0&&c>d;h?d++:d--){var m=~~(d/a),p=d-m*a;if(r=this.rows[m].cells[p],n=Backgrid.callByNeed(r.column.renderable(),r.column,r.model),o=Backgrid.callByNeed(r.column.editable(),r.column,e),n&&o){r.enterEditMode();break}}}return this}}),Footer=Backgrid.Footer=Backbone.View.extend({tagName:"tfoot",initialize:function(e){requireOptions(e,["columns","collection"]),this.parent=e.parent,this.columns=e.columns,this.columns instanceof Backbone.Collection||(this.columns=new Backgrid.Columns(this.columns))}}),Grid=Backgrid.Grid=Backbone.View.extend({tagName:"table",className:"backgrid",header:Header,body:Body,footer:null,initialize:function(e){requireOptions(e,["columns","collection"]),e.columns instanceof Backbone.Collection||(e.columns=new Columns(e.columns)),this.columns=e.columns,this.header=e.header||this.header,this.header=new this.header(e),this.body=e.body||this.body,this.body=new this.body(e),this.footer=e.footer||this.footer,this.footer&&(this.footer=new this.footer(e)),this.listenTo(this.columns,"reset",function(){this.header=new(this.header.remove().constructor)(e),this.body=new(this.body.remove().constructor)(e),this.footer&&(this.footer=new(this.footer.remove().constructor)(e)),this.render()})},insertRow:function(e,t,i){return this.body.insertRow(e,t,i)},removeRow:function(e,t,i){return this.body.removeRow(e,t,i)},insertColumn:function(e,t){return t=t||{render:!0},this.columns.add(e,t),this},removeColumn:function(e,t){return this.columns.remove(e,t),this},render:function(){return this.$el.empty(),this.$el.append(this.header.render().$el),this.footer&&this.$el.append(this.footer.render().$el),this.$el.append(this.body.render().$el),this.trigger("rendered"),this},remove:function(){return this.header.remove.apply(this.header,arguments),this.body.remove.apply(this.body,arguments),this.footer&&this.footer.remove.apply(this.footer,arguments),Backbone.View.prototype.remove.apply(this,arguments)},muFunc:function(){alert("muFunv")}}),EmptyRow=Backgrid.EmptyRow=Backbone.View.extend({tagName:"tr",emptyText:null,initialize:function(e){this.emptyText=e.emptyText,this.columns=e.columns},render:function(){this.$el.empty();var e=document.createElement("td");return e.setAttribute("colspan",this.columns.length),e.textContent=_.result(this,"emptyText"),this.el.setAttribute("class","empty"),this.el.appendChild(e),this}})}(this,$,_,Backbone);